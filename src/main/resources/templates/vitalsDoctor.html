<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Patient Vitals</title>
  <link rel="stylesheet" th:href="@{/css/sharedLayout.css}">
  <link rel="stylesheet" th:href="@{/css/vitals.css}">
</head>
<body>

<div class="layout-container">
  <!-- Sidebar -->
  <aside th:replace="~{layouts/sharedLayout :: sidebar (activePage='vitals', appointmentId=${appointmentId})}"></aside>

  <!-- Main Content Area -->
  <main class="main-content">
    <!-- Top Navigation -->
    <header th:replace="components/top-navD :: top-nav('Patient Vitals History')"></header>

    <!-- Patient Info Card -->
    <section th:replace="components/patientCard :: patientCard(${appointmentId})"></section>

    <!-- Vitals Content -->
    <section class="page-content">
      <!-- Vitals History -->
      <div class="vital-history">
        <div class="history-header">
          <h3>Vitals History (View All)</h3>
          <a th:href="@{/vitalsHistoryPage(appointmentId=${appointmentId})}" class="view-all-btn">View All</a>
        </div>
        <table class="history-table">
          <thead>
          <tr>
            <th>Date Of Visit</th>
            <th>BP (mmHg)</th>
            <th>HR (bpm)</th>
            <th>Temp (Â°C)</th>
            <th>Recorded By</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td>10 Jul 2025</td>
            <td>120/78</td>
            <td>82</td>
            <td>37.1</td>
            <td>Dr. Sarah Moyo</td>
          </tr>
          <tr>
            <td>18 Jun 2024</td>
            <td>130/85</td>
            <td>90</td>
            <td>37.8</td>
            <td>Dr. Samuel Chen</td>
          </tr>
          <tr>
            <td>02 May 2024</td>
            <td>118/75</td>
            <td>76</td>
            <td>36.9</td>
            <td>Dr. Linda Patel</td>
          </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>
</div>

<!-- Scripts -->
<script th:src="@{/js/sharedLayout.js}"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      const vitalsForm = document.getElementById('vitalsForm');
      const saveBtn = document.querySelector('.save-btn');

      // Auto-calculate BMI when weight or height changes
      const weightInput = document.getElementById('weight');
      const heightInput = document.getElementById('height');
      const bmiInput = document.getElementById('bmi');

      function calculateBMI() {
          const weight = parseFloat(weightInput.value);
          const height = parseFloat(heightInput.value);

          if (weight && height && height > 0) {
              const heightInMeters = height / 100; // Convert cm to meters
              const bmi = weight / (heightInMeters * heightInMeters);
              bmiInput.value = bmi.toFixed(1);
          }
      }

      weightInput.addEventListener('input', calculateBMI);
      heightInput.addEventListener('input', calculateBMI);

      // Blood pressure validation
      const bloodPressureInput = document.getElementById('blood-pressure');
      bloodPressureInput.addEventListener('input', function() {
          const value = this.value;
          // Allow format like "120/80" or "120/80 mmHg"
          const regex = /^\d{2,3}\/\d{2,3}(\s*mmHg)?$/;
          if (value && !regex.test(value)) {
              this.setCustomValidity('Please enter blood pressure in format: 120/80 (systolic/diastolic)');
          } else {
              this.setCustomValidity('');
          }
      });

      // Update recorded time
      function updateRecordedTime() {
          const now = new Date();
          const options = {
              day: 'numeric',
              month: 'long',
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
          };
          const timeString = now.toLocaleDateString('en-US', options);
          document.querySelector('.record-time span').textContent = timeString;
      }

      // Show notification function
      function showNotification(message, type) {
          // Create notification element
          const notification = document.createElement('div');
          notification.className = `notification ${type}`;
          notification.textContent = message;
          notification.style.cssText = `
              position: fixed;
              top: 20px;
              right: 20px;
              background: ${type === 'success' ? '#4CAF50' : '#f44336'};
              color: white;
              padding: 12px 20px;
              border-radius: 6px;
              z-index: 10000;
              font-size: 14px;
              opacity: 0;
              transform: translateX(100%);
              transition: all 0.3s ease;
          `;

          document.body.appendChild(notification);

          // Animate in
          setTimeout(() => {
              notification.style.opacity = '1';
              notification.style.transform = 'translateX(0)';
          }, 10);

          // Remove after 3 seconds
          setTimeout(() => {
              notification.style.opacity = '0';
              notification.style.transform = 'translateX(100%)';
              setTimeout(() => {
                  if (notification.parentNode) {
                      notification.parentNode.removeChild(notification);
                  }
              }, 300);
          }, 3000);
      }
  });
</script>

</body>
</html>
