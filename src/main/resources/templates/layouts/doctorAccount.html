<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Hospital - Account Settings</title>
  <!-- Page-specific CSS -->
  <link rel="stylesheet" th:href="@{/css/doctorAccount.css}">
</head>
<body>
<!-- Temporary simple layout, to be replaced once the shared layout is ready -->
<div class="simple-layout">
  <header class="simple-header">
    <h1>Account Settings</h1>
  </header>

  <main class="simple-content">
    <!-- Profile Section -->
    <div class="profile-info">
      <div class="profile-left">
        <div class="profile-avatar">ðŸ‘¤</div>
        <div class="profile-details">
          <h3 class="profile-name">Ginny Weasley</h3>
          <div class="profile-title">Doctor</div>
          <div class="profile-location">Bristol, United Kingdom</div>
        </div>
      </div>
      <div class="profile-right">
        <button class="edit-photo-btn">Edit Photo</button>
      </div>
    </div>

    <!-- Personal Information Section -->
    <div class="info-section">
      <div class="section-header">
        <div class="section-title">Personal Information</div>
        <button class="edit-btn" onclick="toggleEdit('personal')">Edit</button>
      </div>

      <form id="personalForm">
        <div class="info-grid">
          <div class="info-field">
            <div class="info-label">First Name</div>
            <input type="text" name="firstName" value="Ginny" readonly>
          </div>
          <div class="info-field">
            <div class="info-label">Last Name</div>
            <input type="text" name="lastName" value="Weasley" readonly>
          </div>
          <div class="info-field">
            <div class="info-label">Date of Birth</div>
            <input type="text" value="23/08/1999" readonly>
          </div>
          <div class="info-field">
            <div class="info-label">Email Address</div>
            <input type="email" name="email" value="weasley666@gmail.com" readonly>
          </div>
          <div class="info-field">
            <div class="info-label">Phone Number</div>
            <input type="tel" name="phoneNumber" value="+44 07411 234567" readonly>
          </div>
          <div class="info-field">
            <div class="info-label">Gender</div>
            <select name="gender" disabled>
              <option value="Female" selected>Female</option>
              <option value="Male">Male</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>
        <div class="form-actions" id="personalActions">
          <button type="button" onclick="cancelEdit('personal')" class="cancel-btn">Cancel</button>
          <button type="submit" class="save-btn">Save</button>
        </div>
      </form>
    </div>

    <!-- Hospital Information Section -->
    <div class="info-section">
      <div class="section-header">
        <div class="section-title">Hospital Information</div>
        <button class="edit-btn" onclick="toggleEdit('hospital')">Edit</button>
      </div>

      <form id="hospitalForm">
        <div class="info-grid">
          <div class="info-field">
            <div class="info-label">Position</div>
            <input type="text" value="Doctor" readonly>
          </div>
          <div class="info-field">
            <div class="info-label">Department</div>
            <input type="text" value="General Medicine" readonly>
          </div>
          <div class="info-field">
            <div class="info-label">Employee ID</div>
            <input type="text" value="GD68894300" readonly>
          </div>
          <div class="info-field">
            <div class="info-label">Work Location</div>
            <input type="text" value="Bristol Hospital, UK" readonly>
          </div>
          <div class="info-field">
            <div class="info-label">Date Joined</div>
            <input type="text" value="01/06/2021" readonly>
          </div>
        </div>
        <div class="form-actions" id="hospitalActions">
          <button type="button" onclick="cancelEdit('hospital')" class="cancel-btn">Cancel</button>
          <button type="submit" class="save-btn">Save</button>
        </div>
      </form>
    </div>
  </main>
</div>

<script>
  const originalData = {
    personal: {},
    hospital: {}
  };

  document.addEventListener('DOMContentLoaded', function() {
    saveOriginalData('personal');
    saveOriginalData('hospital');
  });

  function saveOriginalData(section) {
    const form = document.getElementById(section + 'Form');
    const inputs = form.querySelectorAll('input, select');
    originalData[section] = {};

    inputs.forEach(input => {
      if (input.name) {
        originalData[section][input.name] = input.value;
      }
    });
  }

  function toggleEdit(section) {
    const form = document.getElementById(section + 'Form');
    const inputs = form.querySelectorAll('input, select');
    const actions = document.getElementById(section + 'Actions');
    const editBtn = document.querySelector(`[onclick="toggleEdit('${section}')"]`);

    if (inputs[0].readOnly || inputs[0].disabled) {
      inputs.forEach(input => {
        if (input.parentElement.querySelector('.info-label').textContent !== 'Date of Birth') {
          input.readOnly = false;
          input.disabled = false;
          input.classList.add('editable');
        }
      });
      actions.style.display = 'flex';
      editBtn.textContent = 'Cancel';
      editBtn.classList.add('editing');
      editBtn.setAttribute('onclick', `cancelEdit('${section}')`);
    } else {
      cancelEdit(section);
    }
  }

  function cancelEdit(section) {
    const form = document.getElementById(section + 'Form');
    const inputs = form.querySelectorAll('input, select');
    const actions = document.getElementById(section + 'Actions');
    const editBtn = document.querySelector(`[onclick="cancelEdit('${section}')"]`);

    inputs.forEach(input => {
      input.readOnly = true;
      input.disabled = true;
      input.classList.remove('editable');

      if (input.name && originalData[section][input.name]) {
        input.value = originalData[section][input.name];
      }
    });

    actions.style.display = 'none';
    editBtn.textContent = 'Edit';
    editBtn.classList.remove('editing');
    editBtn.setAttribute('onclick', `toggleEdit('${section}')`);
  }

  document.getElementById('personalForm').addEventListener('submit', function(e) {
    e.preventDefault();
    alert('Personal information saved successfully!');
    cancelEdit('personal');
    saveOriginalData('personal');
  });

  document.getElementById('hospitalForm').addEventListener('submit', function(e) {
    e.preventDefault();
    alert('Hospital information saved successfully!');
    cancelEdit('hospital');
    saveOriginalData('hospital');
  });

  document.querySelector('.edit-photo-btn').addEventListener('click', function() {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/*';
    fileInput.style.display = 'none';

    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const imageUrl = e.target.result;
          const profileAvatar = document.querySelector('.profile-avatar');
          profileAvatar.innerHTML = `<img src="${imageUrl}" alt="Profile Picture" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
        };
        reader.readAsDataURL(file);
      }
    });

    document.body.appendChild(fileInput);
    fileInput.click();
    document.body.removeChild(fileInput);
  });
</script>
</body>
</html>
