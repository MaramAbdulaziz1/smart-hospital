<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" th:href="@{/css/sharedLayout.css}">
  <link rel="stylesheet" href="/css/patientreport.css"/>
  <title>Patient Profile</title>
</head>
<body>

<div class="layout-container dashboard-page">
  <!-- Sidebar -->
  <aside th:replace="~{layouts/sharedLayout :: sidebar(activePage='patientProfile', appointmentId=${appointmentId})}"></aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Navigation -->
    <header th:replace="components/top-navD :: top-nav('Patient Profile')"></header>

    <!-- Patient Report -->
    <form>
      <!-- Patient Info & Visit Details -->
      <div class="form-grid">
        <div class="form-group">
          <label>Patient Name</label>
          <p th:text="${visitRecord.patientName}">John Doe</p>
        </div>
        <div class="form-group">
          <label>Patient Code</label>
          <p th:text="${visitRecord.patientCode}">P-12345</p>
        </div>
        <div class="form-group">
          <label>Date of Visit</label>
          <p th:text="${#temporals.format(visitRecord.dateOfVisit, 'dd MMM yyyy')}">10 Jul 2025</p>
        </div>
        <div class="form-group">
          <label>Doctor</label>
          <p th:text="${visitRecord.doctorName}">Dr Sarah Johnson</p>
        </div>
        <div class="form-group">
          <label>Department</label>
          <p th:text="${visitRecord.department}">Neurology</p>
        </div>
      </div>

      <!-- Diagnosis -->
      <div class="card">
        <h3 class="card-title">Diagnosis</h3>
        <p th:if="${visitRecord.diagnosis != null and !visitRecord.diagnosis.trim().isEmpty()}"
           th:text="${visitRecord.diagnosis}">Diagnosis details</p>
        <p th:if="${visitRecord.diagnosis == null or visitRecord.diagnosis.trim().isEmpty()}"
           class="no-data">No diagnosis recorded</p>
      </div>

      <!-- Doctor's Notes -->
      <div class="card">
        <h3 class="card-title">Clinical Notes</h3>
        <p th:if="${visitRecord.doctorsNotes != null and !visitRecord.doctorsNotes.trim().isEmpty()}"
           th:text="${visitRecord.doctorsNotes}">Clinical notes</p>
        <p th:if="${visitRecord.doctorsNotes == null or visitRecord.doctorsNotes.trim().isEmpty()}"
           class="no-data">No clinical notes available</p>
      </div>

      <!-- Treatment and Follow-up Plan -->
      <div class="card">
        <h3 class="card-title">Treatment and Follow-up Plan</h3>
        <div class="treatment-content">

          <!-- Treatment Plan -->
          <div class="treatment-item">
            <strong>Treatment Plan:</strong>
            <p th:if="${visitRecord.treatmentPlan != null and !visitRecord.treatmentPlan.trim().isEmpty()}"
               th:text="${visitRecord.treatmentPlan}">Treatment details</p>
            <p th:if="${visitRecord.treatmentPlan == null or visitRecord.treatmentPlan.trim().isEmpty()}"
               class="no-data">No treatment plan specified</p>
          </div>

          <!-- Medications Prescribed -->
          <div class="treatment-item">
            <strong>Medications Prescribed:</strong>
            <div th:if="${visitRecord.medicationsPrescribed != null and !visitRecord.medicationsPrescribed.isEmpty()}">
              <ul class="medical-list">
                <li th:each="med : ${visitRecord.medicationsPrescribed}" th:text="${med}">Medication</li>
              </ul>
            </div>
            <p th:if="${visitRecord.medicationsPrescribed == null or visitRecord.medicationsPrescribed.isEmpty()}"
               class="no-data">No medications prescribed</p>
          </div>
        </div>
      </div>

      <!-- Medical History -->
      <div class="card">
        <h3 class="card-title">Medical History</h3>
        <div class="medical-grid">

          <!-- Past Medical Conditions -->
          <div class="medical-grid-item">
            <label>Past Medical Conditions:</label>
            <p th:if="${visitRecord.pastMedicalConditions != null and !visitRecord.pastMedicalConditions.trim().isEmpty()}"
               th:text="${visitRecord.pastMedicalConditions}">Hypertension, Diabetes</p>
            <p th:if="${visitRecord.pastMedicalConditions == null or visitRecord.pastMedicalConditions.trim().isEmpty()}"
               class="no-data">None</p>
          </div>

          <!-- Past Medications -->
          <div class="medical-grid-item">
            <label>Past Medications:</label>
            <p th:if="${visitRecord.pastMedications != null and !visitRecord.pastMedications.trim().isEmpty()}"
               th:text="${visitRecord.pastMedications}">Lisinopril, Metformin</p>
            <p th:if="${visitRecord.pastMedications == null or visitRecord.pastMedications.trim().isEmpty()}"
               class="no-data">None</p>
          </div>

          <!-- Current Medications -->
          <div class="medical-grid-item">
            <label>Current Medications:</label>
            <div th:if="${visitRecord.currentMedications != null and !visitRecord.currentMedications.isEmpty()}">
              <ul class="medical-list">
                <li th:each="med : ${visitRecord.currentMedications}" th:text="${med}">Medication</li>
              </ul>
            </div>
            <p th:if="${visitRecord.currentMedications == null or visitRecord.currentMedications.isEmpty()}"
               class="no-data">None</p>
          </div>

          <!-- Past Surgical History -->
          <div class="medical-grid-item">
            <label>Past Surgical History:</label>
            <p th:if="${visitRecord.pastSurgicalHistory != null and !visitRecord.pastSurgicalHistory.trim().isEmpty()}"
               th:text="${visitRecord.pastSurgicalHistory}">Appendectomy (2010)</p>
            <p th:if="${visitRecord.pastSurgicalHistory == null or visitRecord.pastSurgicalHistory.trim().isEmpty()}"
               class="no-data">None</p>
          </div>

          <!-- Allergies -->
          <div class="medical-grid-item">
            <label>Allergies:</label>
            <p th:if="${visitRecord.allergies != null and !visitRecord.allergies.trim().isEmpty()}"
               th:text="${visitRecord.allergies}">Penicillin</p>
            <p th:if="${visitRecord.allergies == null or visitRecord.allergies.trim().isEmpty()}"
               class="no-data">None</p>
          </div>

          <!-- Family History -->
          <div class="medical-grid-item">
            <label>Family History:</label>
            <p th:if="${visitRecord.familyHistory != null and !visitRecord.familyHistory.trim().isEmpty()}"
               th:text="${visitRecord.familyHistory}">Father: Heart disease</p>
            <p th:if="${visitRecord.familyHistory == null or visitRecord.familyHistory.trim().isEmpty()}"
               class="no-data">No family history recorded</p>
          </div>

          <!-- Social History -->
          <div class="medical-grid-item full-width">
            <label>Social History:</label>
            <p th:if="${visitRecord.socialHistory != null and !visitRecord.socialHistory.trim().isEmpty()}"
               th:text="${visitRecord.socialHistory}">Non-smoker, occasional alcohol</p>
            <p th:if="${visitRecord.socialHistory == null or visitRecord.socialHistory.trim().isEmpty()}"
               class="no-data">No social history recorded</p>
          </div>
        </div>
      </div>

      <!-- Vitals -->
      <div class="card">
        <h3 class="card-title">Vitals</h3>
        <a th:href="@{/vitals-doctor(appointmentId=${appointmentId})}" class="btn btn-primary vitals-btn">
          View Vitals History
        </a>
      </div>

    </form>
  </main>
</div>

<script>
  // Dropdown functionality
  document.addEventListener('DOMContentLoaded', () => {
      const dateDropdown = document.getElementById('dateDropdown');
      const dateInput = document.getElementById('visit-date');
      const dropdownMenu = document.getElementById('dateDropdownMenu');

      if (dateDropdown && dateInput && dropdownMenu) {
          // Toggle dropdown open/close
          dateDropdown.addEventListener('click', (e) => {
              if (!e.target.classList.contains('dropdown-item')) {
                  dateDropdown.classList.toggle('open');
              }
          });

          // Handle dropdown item selection
          dropdownMenu.addEventListener('click', (e) => {
              if (e.target.classList.contains('dropdown-item')) {
                  // Update selected item
                  document.querySelectorAll('.dropdown-item.selected').forEach(item =>
                      item.classList.remove('selected')
                  );
                  e.target.classList.add('selected');

                  // Update input value and close dropdown
                  dateInput.value = e.target.textContent.trim();
                  dateDropdown.classList.remove('open');
              }
          });

          // Close dropdown when clicking outside
          document.addEventListener('click', (e) => {
              if (!dateDropdown.contains(e.target)) {
                  dateDropdown.classList.remove('open');
              }
          });
      }

      // Form interactions
      document.querySelectorAll('.form-control').forEach(input => {
          input.addEventListener('focus', () => input.style.transform = 'scale(1.02)');
          input.addEventListener('blur', () => input.style.transform = 'scale(1)');
      });
  });

</script>
<!-- Fragment: no-data.html -->
<p th:if="${data == null or #lists.isEmpty(data)}" class="no-data">No data available</p>

</body>
</html>

